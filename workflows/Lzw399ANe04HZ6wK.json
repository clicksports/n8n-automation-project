{
  "createdAt": "2024-07-18T14:16:00.169Z",
  "updatedAt": "2024-08-21T15:13:55.000Z",
  "id": "Lzw399ANe04HZ6wK",
  "name": "Validate processing SSL orders",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://my.gogetssl.com/api/auth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "user",
              "value": "ssl@clicksports.de"
            },
            {
              "name": "pass",
              "value": "4e11675a327aad6831703c82fdf01bea"
            }
          ]
        },
        "options": {}
      },
      "id": "bd2bfc90-754a-4092-a06e-eac988393958",
      "name": "Authentication",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -2980,
        900
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "id": "c5995585-b08c-4862-8e18-d148ee92a61f",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -3200,
        900
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Funktion zum Laden der Public Suffix List\nasync function loadPublicSuffixList() {\n    const response = await this.helpers.request({\n        method: 'GET',\n        url: 'https://raw.githubusercontent.com/publicsuffix/list/master/public_suffix_list.dat',\n        json: false,\n    });\n    \n    const suffixes = response.split('\\n')\n        .map(line => line.trim())\n        .filter(line => line && !line.startsWith('//') && !line.startsWith('!'));\n\n    return suffixes;\n}\n\n// Funktion zum Extrahieren der Basisdomain\nfunction getBaseDomain(domain, publicSuffixList) {\n    const domainParts = domain.split('.');\n    const domainPartsLength = domainParts.length;\n\n    // Prüfe auf öffentliche Suffixe von der längsten zur kürzesten\n    for (let i = 0; i < publicSuffixList.length; i++) {\n        const suffix = publicSuffixList[i];\n        const suffixParts = suffix.split('.');\n        const suffixPartsLength = suffixParts.length;\n\n        // Wenn das Ende der Domain mit dem öffentlichen Suffix übereinstimmt\n        if (domainParts.slice(-suffixPartsLength).join('.') === suffix) {\n            // Nimm den Teil vor dem öffentlichen Suffix als Basisdomain\n            return domainParts.slice(-(suffixPartsLength + 1)).join('.');\n        }\n    }\n\n    // Standardlogik für zweigliedrige TLDs\n    if (domainPartsLength >= 2) {\n        return domainParts.slice(-2).join('.');\n    } else {\n        return domain;\n    }\n}\n\n// Public Suffix List wird nur einmal geladen und in einer globalen Variable gespeichert\nif (!global.publicSuffixList) {\n    global.publicSuffixList = await loadPublicSuffixList();\n}\n\n// Verarbeitung jedes Items einzeln\nconst domain = item.json.domain; // Ersetze dies durch den tatsächlichen Pfad zu deiner Domain\nconst baseDomain = getBaseDomain(domain, global.publicSuffixList);\n\nreturn {\n    json: { ...item.json, baseDomain },\n};\n"
      },
      "id": "885a30e8-5458-46aa-9707-aa0d2796f60e",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1120,
        580
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://my.gogetssl.com/api/orders/ssl/change_validation_method/{{ $('Validation').item.json.order_id }}/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "domain",
              "value": "={{ $('Validation').item.json.domain }}"
            },
            {
              "name": "new_method",
              "value": "dns"
            }
          ]
        },
        "options": {}
      },
      "id": "e36a1476-cec4-47db-86d1-d448cc7033d7",
      "name": "Change validation method to dns",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        4260,
        940
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {},
      "id": "7027584c-9581-4f8b-b229-93213fe59be2",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -3160,
        660
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "plesk_domainpool",
        "include": "allOtherFields",
        "options": {
          "destinationFieldName": "hostname"
        }
      },
      "id": "5fa2300c-d015-4c4d-9911-128140fd3af6",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -620,
        900
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "75f7657b-7717-4c36-90fa-30a42100978c",
              "leftValue": "={{ $json.code }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a977b91b-2080-43c7-a1b7-be76c4ac4197",
      "name": "If3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        820,
        800
      ]
    },
    {
      "parameters": {
        "errorMessage": "={{ $json.stderr }}"
      },
      "id": "b7e96a29-adc3-4041-a042-7477dd1b6dce",
      "name": "Could not search for vhost",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        1180,
        980
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f53176f2-5673-4715-bcfb-c76508895782",
              "name": "plesk_domainpool",
              "value": "=[\"www.{{ $json.domain }}\", \"{{ $json.domain }}\", \"{{ $json.baseDomain }}\", \"plesk.{{ $json.domain }}\", \"plesk.{{ $json.baseDomain }}\", \"org-www.clicksports.de\"]",
              "type": "array"
            },
            {
              "id": "4a56981d-6e0b-46f9-8085-a281d72b09d1",
              "name": "domain_name",
              "value": "={{ $json.domain }}",
              "type": "string"
            },
            {
              "id": "29d958cf-fade-4465-aa99-8f86c871d935",
              "name": "approver_method",
              "value": "={{ $json.approver_method }}",
              "type": "object"
            },
            {
              "id": "9a43d22d-28ca-4e18-9bda-200a6f37e696",
              "name": "order_id",
              "value": "={{ $json.order_id }}",
              "type": "number"
            }
          ]
        },
        "options": {
          "ignoreConversionErrors": false
        }
      },
      "id": "e37c6e06-0210-4cda-b334-41ad2a9a985c",
      "name": "Domain",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -920,
        900
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3f5a7a3f-0eea-4b88-8fb1-147cb7b4f2a7",
              "name": "hostname",
              "value": "={{ $('Host').item.json.hostname }}",
              "type": "string"
            },
            {
              "id": "5de1eb4f-773b-46bb-9d6f-3412fabfcfd6",
              "name": "rootfolder",
              "value": "={{ $json.stdout }}",
              "type": "string"
            },
            {
              "id": "f0017b93-d9ff-4326-82f6-6079872ef9e5",
              "name": "validationfolder",
              "value": "={{ $json.stdout }}/.well-known/pki-validation",
              "type": "string"
            },
            {
              "id": "5ad4897d-86b3-4d01-abef-21a8ecae2f61",
              "name": "order_id",
              "value": "={{ $('Domain').item.json.order_id }}",
              "type": "number"
            },
            {
              "id": "7fc223fd-1a94-468d-9468-ee1531b7edaf",
              "name": "domain",
              "value": "={{ $('Domain').item.json.domain_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "2185ff0a-c762-49ff-948a-17834217babe",
      "name": "Folders",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1180,
        780
      ]
    },
    {
      "parameters": {
        "amount": "=5",
        "unit": "minutes"
      },
      "id": "6c2905e7-3691-4924-bfb4-85936b90377f",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2300,
        680
      ],
      "webhookId": "a3a34f6c-9895-45fb-8472-73a6f36ada52"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "approver_method.https.content",
        "options": {
          "fileName": "={{ $json.approver_method.https.filename }}"
        }
      },
      "id": "474c7f1e-1de1-4606-81c1-608f529697c6",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -620,
        660
      ],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "resource": "file",
        "path": "={{ $('Validation').item.json.validationfolder }}",
        "options": {}
      },
      "id": "8bd9a87b-3c57-47eb-a8ae-3840d42edfd2",
      "name": "SSH",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        2040,
        680
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "compare": "selectedFields",
        "fieldsToCompare": "validationfolder",
        "options": {}
      },
      "id": "43226c53-2256-4b81-a45f-f088c06bfcbd",
      "name": "Remove Duplicates",
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 1.1,
      "position": [
        1480,
        780
      ]
    },
    {
      "parameters": {
        "unit": "minutes"
      },
      "id": "e3ba8dd8-6111-472e-ba25-b2c47fc53820",
      "name": "Wait1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3040,
        480
      ],
      "webhookId": "b0271979-7ac3-4b4e-9c6c-98d8b875fe11"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://my.gogetssl.com/api/orders/ssl/revalidate/{{ $('Validation').item.json.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "domain",
              "value": "={{ $('Validation').item.json.domain }}"
            }
          ]
        },
        "options": {}
      },
      "id": "55d65cd6-4aa2-4c14-8d88-d34b9be90506",
      "name": "Try validate https",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        2540,
        680
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://my.gogetssl.com/api/orders/ssl/revalidate/{{ $('Validation').item.json.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "domain",
              "value": "={{ $('Validation').item.json.domain }}"
            }
          ]
        },
        "options": {}
      },
      "id": "877d53a7-4b62-4f67-ab94-53b32a7d4ece",
      "name": "Try revalidate https",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        3280,
        700
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://my.gogetssl.com/api/orders",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "status",
              "value": "processing"
            }
          ]
        },
        "options": {}
      },
      "id": "87336115-4f84-4275-ae5f-a7f8355d2738",
      "name": "Get processing orders",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -2740,
        900
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "=plesk bin dns --add {{ $('Validation').item.json.domain.replace(/^www\\./, '') }} -cname $(echo {{ $('DNS Validation').item.json.approver_method.dns.record.split(' ')[0] }} | sed 's/\\.{{ $('Validation').item.json.domain.replace(/^www\\./, '')}}//') -canonical {{ $('DNS Validation').item.json.approver_method.dns.record.split(' ')[2] }}",
        "cwd": "=/"
      },
      "id": "396b2c64-b437-4b23-924d-327fa0b0e731",
      "name": "Add new DNS record",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        5340,
        1060
      ],
      "alwaysOutputData": true,
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "unit": "minutes"
      },
      "id": "eb902209-58a3-4556-9feb-90caca414f83",
      "name": "Wait2",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3520,
        700
      ],
      "webhookId": "d5f33be3-f06c-430f-a548-deb0fac283ad"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.description }}",
                    "rightValue": "locked",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "locked"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "37e7dcd5-160d-4ad2-a97f-81a28929714c",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        2800,
        680
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e250fa17-495a-46de-91ca-5f3fc8b8f836",
              "name": "hostname",
              "value": "={{ $('Validation').item.json.hostname }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "f62b5114-59d0-4658-a0aa-5afef402ae24",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4820,
        940
      ]
    },
    {
      "parameters": {
        "url": "=https://my.gogetssl.com/api/orders/status/{{ $('Validation').item.json.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "options": {}
      },
      "id": "d0a5bbd1-7b97-4964-9687-a290d6c69a57",
      "name": "Validation status",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        3760,
        700
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://my.gogetssl.com/api/orders/status/{{ $('Validation').item.json.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "options": {}
      },
      "id": "7ea42742-d241-430e-a96a-dbf0c4741b56",
      "name": "DNS Validation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        4540,
        940
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "unit": "minutes"
      },
      "id": "b341d4b4-f345-4943-881f-e6e8729a8715",
      "name": "Wait3",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5600,
        1060
      ],
      "webhookId": "ac0669d7-afcc-4773-9654-2f86c503564f"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "=plesk bin dns --info {{ $('Validation').item.json.domain.replace(/^www\\./, '') }} | grep 'sectigo'",
        "cwd": "=/"
      },
      "id": "f3e85cc1-fe1f-4087-8fbc-2b7208cab767",
      "name": "Find old DNS records",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        5340,
        820
      ],
      "alwaysOutputData": true,
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "= plesk bin dns --del {{ $('Validation').item.json.domain.replace(/^www\\./, '') }} -cname  -canonical "
      },
      "id": "153ca7ed-1174-4d76-a521-06090fd03dce",
      "name": "Delete",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        6160,
        600
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "={{ $json.stdout.split('\\n')  }}",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "91792b14-9749-4d52-9132-dc8e1a8c2a41",
      "name": "Split Out1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        5560,
        820
      ],
      "disabled": true
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "156f72a0-e964-43a4-842f-fc6fb0edae8a",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        5740,
        480
      ],
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://my.gogetssl.com/api/orders/ssl/revalidate/{{ $('Validation').item.json.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "domain",
              "value": "={{ $('Validation').item.json.domain }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3362f745-bef3-499c-96a7-4a5bb07a5a1b",
      "name": "Validate DNS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        5840,
        1060
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "orders",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "98953c2f-8b45-466b-93e2-ff71bba84add",
      "name": "Orders",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        -2500,
        900
      ]
    },
    {
      "parameters": {
        "url": "=https://my.gogetssl.com/api/orders/status/{{ $('Orders').item.json.orders.order_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "options": {}
      },
      "id": "660abb61-8a56-40a8-95b4-52fd4a217fad",
      "name": "validation data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -1360,
        580
      ],
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://my.gogetssl.com/api/orders/ssl/change_validation_method/{{ $json.orders.order_id }}/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "domain",
              "value": "={{ $json.orders.common_name }}"
            },
            {
              "name": "new_method",
              "value": "https"
            }
          ]
        },
        "options": {}
      },
      "id": "adc9f078-cd8d-4191-8e56-890ec145f932",
      "name": "Change validation method to https",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -1760,
        780
      ],
      "alwaysOutputData": true,
      "credentials": {
        "httpQueryAuth": {
          "id": "pskjhKSslGfoyCfJ",
          "name": "GoGetSSL"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b3f1760d-b2bb-49cd-b180-b97e34281ad5",
              "leftValue": "={{ $json.orders.common_name }}",
              "rightValue": "=www.gutmann-factory.de",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9f9b4d38-0d46-439b-83d4-89f3697e370e",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -2280,
        900
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ea4f71b7-2f4a-4464-8b8b-99a0cc3d1451",
              "name": "hostname",
              "value": "={{ $json.hostname }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "67c0f670-6896-4796-8d34-362819300bfa",
      "name": "Host",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -340,
        900
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "95e1b9ad-f056-43db-a3e2-c85ce030f98f",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -120,
        900
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "a944e985-f927-4e44-b4fa-8631e5064580",
              "leftValue": "={{ $json.code }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "looseTypeValidation": true
        }
      },
      "id": "2ee8c59e-7ec6-490a-be39-a08c8d76c64a",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        480,
        920
      ]
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "=plesk bin domain -i {{ $('Domain').item.json.domain_name.replace(/^www\\./, '') }} | sed -n 's/.*--WWW-Root--: //p'",
        "cwd": "=/"
      },
      "id": "3a260382-427d-426b-99d3-5881923bf11c",
      "name": "Get domain root",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        200,
        920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "c333694a-917b-45c7-bd3a-c9e5d0d1962a",
              "leftValue": "={{ $json.status_description }}",
              "rightValue": "validation",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": true,
          "looseTypeValidation": true
        }
      },
      "id": "45da48b1-89d0-460f-8e47-b5ba23e0afea",
      "name": "If4",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        3980,
        700
      ]
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "resource": "file",
        "path": "={{ $('Validation').item.json.validationfolder }}",
        "options": {}
      },
      "id": "8eaac8fd-fac4-4086-b917-ed86660e6069",
      "name": "Update certificate in Plesk",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        4260,
        560
      ],
      "credentials": {
        "sshPrivateKey": {
          "id": "7cM8UD60RNSc7v3k",
          "name": "SSH Hcloud"
        }
      },
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "id": "7937ab14-a456-4f60-ad9e-2dc2af3b56b2",
      "name": "Validation",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        1760,
        680
      ]
    },
    {
      "parameters": {
        "amount": "=5",
        "unit": "minutes"
      },
      "id": "ec0c146b-eb1e-4956-b785-764be0441994",
      "name": "Wait4",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1980,
        780
      ],
      "webhookId": "a3a34f6c-9895-45fb-8472-73a6f36ada52"
    },
    {
      "parameters": {
        "amount": "=5",
        "unit": "minutes"
      },
      "id": "06e692da-6256-49a7-b3fc-c9e1022e4240",
      "name": "Wait5",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1580,
        580
      ],
      "webhookId": "a3a34f6c-9895-45fb-8472-73a6f36ada52"
    }
  ],
  "connections": {
    "Authentication": {
      "main": [
        [
          {
            "node": "Get processing orders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Authentication",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Domain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Authentication",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Host",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Folders",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Could not search for vhost",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Domain": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          },
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Folders": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Try validate https",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Validation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSH": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Validation",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Try validate https": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Try revalidate https",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Try revalidate https": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change validation method to dns": {
      "main": [
        [
          {
            "node": "DNS Validation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get processing orders": {
      "main": [
        [
          {
            "node": "Orders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Validation status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Try revalidate https",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Find old DNS records",
            "type": "main",
            "index": 0
          },
          {
            "node": "Add new DNS record",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validation status": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DNS Validation": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add new DNS record": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Validate DNS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find old DNS records": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orders": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "validation data": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Wait4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Host": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Get domain root",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get domain root": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Update certificate in Plesk",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Change validation method to dns",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validation": {
      "main": [
        [
          {
            "node": "SSH",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change validation method to https": {
      "main": [
        [
          {
            "node": "Wait5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait4": {
      "main": [
        [
          {
            "node": "Change validation method to https",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait5": {
      "main": [
        [
          {
            "node": "validation data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "oXwbRnZHgYHUkKj4",
    "timezone": "Europe/Berlin"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrencyRules": [],
      "recurrenceRules": []
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "ffa729dc-30dd-4eae-b901-5e2938298d3d",
  "triggerCount": 1,
  "tags": [
    {
      "createdAt": "2024-07-18T13:44:20.701Z",
      "updatedAt": "2024-07-18T13:44:20.701Z",
      "id": "eg0pjrYy9dLUUASF",
      "name": "ssl"
    }
  ]
}